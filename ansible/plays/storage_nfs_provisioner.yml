---

- name: Deploy nfs storage provisioner backed by local storage
  hosts: cluster_storage
  gather_facts: false
  tags: nfs_provisioner
  roles:
  - role: storage_nfs_provisioner
    api_key: "{{ hostvars['cluster-facts']['api_key'] }}"
    kubeconfig_path: "{{ hostvars['cluster-facts']['kubeconfig_path'] }}"
    openshift_distro: "{{ hostvars['cluster-facts']['openshift_distro'] }}"
    openshift_version: "{{ hostvars['cluster-facts']['openshift_version'] }}"
  - role: test_nfs_provisioner
    api_key: "{{ hostvars['cluster-facts']['api_key'] }}"
    kubeconfig_path: "{{ hostvars['cluster-facts']['kubeconfig_path'] }}"
    when: test_nfs_provisioner is defined
  - role: set_default_storage_class
    api_key: "{{ hostvars['cluster-facts']['api_key'] }}"
    kubeconfig_path: "{{ hostvars['cluster-facts']['kubeconfig_path'] }}"
    default_storage_class: "{{ nfs_storage_class }}"
