---

- name: Create mongo data folders on all worker nodes
  hosts: worker_nodes
  gather_facts: false
  tags: cncf_local_storage
  roles:
  - role: cncf_create_mongo_data_folders
    when: hostvars['cncf-provisioner']['local_storage_required']

- name: Create local storage cluster artifacts
  hosts: cluster_storage
  gather_facts: false
  tags: cncf_local_storage
  roles:
  - role: cncf_local_storage
    cluster_name: "{{ hostvars['cluster-facts']['cluster_name'] }}"
    when: hostvars['cncf-provisioner']['local_storage_required']
  - role: set_default_storage_class
    api_key: "{{ hostvars['cluster-facts']['api_key'] | default(omit) }}"
    kubeconfig_path: "{{ hostvars['cluster-facts']['kubeconfig_path'] }}"
    default_storage_class: common-services-stgclass
    when: hostvars['cncf-provisioner']['local_storage_required']
