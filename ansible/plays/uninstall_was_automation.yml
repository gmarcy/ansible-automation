---

- name: Uninstall IBM WebSphere Automation
  hosts: was_automation
  gather_facts: false
  tags: was_automation
  roles:
  - role: remove_odlm_operands_from_namespace
    api_key: "{{ hostvars['cluster-facts']['api_key'] | default(omit) }}"
    kubeconfig_path: "{{ hostvars['cluster-facts']['kubeconfig_path'] }}"
    target_namespace: "{{ was_automation_namespace }}"
  - role: uninstall_wsa_operands
    api_key: "{{ hostvars['cluster-facts']['api_key'] | default(omit) }}"
    kubeconfig_path: "{{ hostvars['cluster-facts']['kubeconfig_path'] }}"
    target_namespace: "{{ was_automation_namespace }}"
    install_healing: "{{ was_automation_install_healing }}"
    airgap_install: "{{ was_automation_airgap_install }}"
    install_individual_wsa_operands: true
  - role: uninstall_wsa_operator
    api_key: "{{ hostvars['cluster-facts']['api_key'] | default(omit) }}"
    kubeconfig_path: "{{ hostvars['cluster-facts']['kubeconfig_path'] }}"
    operator_singlenamespace: "{{ was_automation_operator_singlenamespace }}"
    target_namespace: "{{ was_automation_namespace }}"
  - role: remove_target_operator_group
    api_key: "{{ hostvars['cluster-facts']['api_key'] | default(omit) }}"
    kubeconfig_path: "{{ hostvars['cluster-facts']['kubeconfig_path'] }}"
    target_namespace: "{{ was_automation_namespace }}"
    target_operator_group: "{{ was_automation_operator_group }}"
  - role: remove_target_namespace
    api_key: "{{ hostvars['cluster-facts']['api_key'] | default(omit) }}"
    kubeconfig_path: "{{ hostvars['cluster-facts']['kubeconfig_path'] }}"
    target_namespace: "{{ was_automation_namespace }}"
