---

all:
  children:
    cluster_operators:
      hosts:
        cluster-operators:
      vars:
        operators_to_deploy:
        - name: openshift-gitops-operator
          namespace: openshift-operators
          catalog: redhat-operators
        - name: openshift-cert-manager-operator
          namespace: tenantmgt-operators
          channel: tech-preview
          catalog: redhat-operators
        - name: open-liberty-certified
          namespace: tenantmgt-operators
          catalog: certified-operators
        - name: ibm-websphere-liberty
          namespace: tenantmgt-operators
          catalog: ibm-operator-catalog
    mcsp_services:
      hosts:
        mcsp-services:
      vars:
        appengine_cluster_name: appengine-tenant
        appengine_cluster_domain: cp.fyre.ibm.com
        appengine_broker_name: app-engine-broker
        appengine_broker_namespace: app-engine
        value_templates:
        - Values:
            environment: "fyre"
            envShortName: "dev"
            namespace: "appe"
            productID: "5F2D21F5-815B-417D-8BB3-1B915E6570BE"
            productName: "IBM App Engine"
            productCode: "appe123"
            productDescription: "IBM Application Engine"
            prometheusQuery: "max(max_over_time(api_calls_total{productId='##.SubscriptionID}}'}[##.Duration}}])) by (productId,tenantId)"
            serviceName: "appengine"
            serviceID: "appengine"
            serviceDescription: "IBM Application Engine service"
            urlPrefix: "{{ appengine_broker_name + '-' + appengine_broker_namespace + '.apps.' + appengine_cluster_name + '.' + appengine_cluster_domain }}"
            #serverCA: "Optional. If you need CSB to validate your OSB Broker CA, add base64 CA Cert here"
            # Usually these should be arrays. Modify this according to the needs
            costs:
              trial:
                unit_id: "API_CALLS_PER_MONTH"
                unit_name: "api calls"
              paid:
                unit_id: "API_CALLS_PER_MONTH"
                unit_name: "api calls"
            criteria:
              trial:
                id: "apiCalls"
                name: "API calls"
              paid:
                id: "apiCalls"
                name: "API calls"
            parts:
              trial:
                partNumber: "TRIAL_APPE"
                partName: "Trial Part APPE"
              paid:
                partNumber: "API_CALLS_APPE"
                partName: "API Calls Part APPE"
            plans:
              trial:
                id: "trial"
                description: "IBM Application Engine trial plan"
                name: "Trial"
              paid:
                id: "paid"
                description: "IBM Application Engine paid plan"
                name: "Paid"
        subscriptions:
        - name: IBM App Engine
          partnum_trial: TRIAL_APPE
          contact_email: gmarcy@us.ibm.com
          contact_username: gmarcy
          contact_ibm_unique_id: IBM967616
          contact_first_name: Glenn
          contact_last_name: Marcy
          trial_id: trial
          product_code: appe123
        tenants:
        - name: "{{ appengine_cluster_name }}"
          subscription: IBM App Engine
          owner_email: gmarcy@us.ibm.com
          owner_ibmid: IBM967616
          owner_ibmuid: IBMid-IBM967616
        mcsp_stm_okd_sa_names_default:
        - 'stm-okd-service-account-admin'
        - 'stm-okd-service-account-update'
        - 'stm-okd-service-account-view'
        mcsp_stm_okd_sa_token_version: v1
        mcsp_stm_okd_sa_names: "{{ inv_mcsp_stm_okd_sa_names | default(mcsp_stm_okd_sa_names_default) }}"
        mcsp_stm_okd_sa_namespace: "{{ inv_mcsp_stm_okd_sa_namespace | default('stm-okd-service-account') }}"
        mcsp_target:
          namespace: tenantns
          csb_host: common-service-broker.common-service-broker.svc.cluster.local
          environment: fyre
          deploy_db: true
        mcsp_argo_services:
          automation-management-console-cd:
            repo: git@github.ibm.com:automation-paas-cd-pipeline/automation-management-console-cd.git
            branch: fyre-v3.4
            local_properties:
              PLACE_HOLDER_AM_CONSOLE_NS: "{{ mcsp_target['namespace_am'] | default('automation-management-console') }}"
              PLACE_HOLDER_REPLICAS: "1"
              MICROSERVICE_NAME: am-console
          mcsp-instance-management-ui-cd:
            repo: git@github.ibm.com:automation-paas-cd-pipeline/mcsp-instance-management-ui-cd.git
            branch: fyre
            local_properties: |
              PLACE_HOLDER_INSTANCE_USERMGTUI_NS=mcsp-instance-user-management
              MICROSERVICE_NAME=mcsp-instance-usermgmt-ui
              REDIS_HOST=redb.redis1.svc.cluster.local
              REDIS_PORT=17997
              REDIS_PASSWORD=password
          usermgt:
            repo: git@github.ibm.com:automation-paas-cd-pipeline/usermgt.git
            branch: fyre-v3
            local_properties:
              PLACE_HOLDER_REPLICAS: "1"
              MICROSERVICE_NAME: usermgtms
          siusermgt:
            repo: git@github.ibm.com:automation-paas-cd-pipeline/siusermgt.git
            branch: fyre-v3.2
            local_properties:
              PLACE_HOLDER_REPLICAS: "1"
              MICROSERVICE_NAME: siusermgtms
          notificationsvc:
            repo: git@github.ibm.com:automation-paas-cd-pipeline/notificationsvc.git
            branch: fyre-v3
            local_properties:
              PLACE_HOLDER_REPLICAS: "1"
              MICROSERVICE_NAME: notificationsvcms
          subscriptmgt:
            repo: git@github.ibm.com:automation-paas-cd-pipeline/subscriptmgt.git
            branch: fyre-v3
            local_properties:
              PLACE_HOLDER_REPLICAS: "1"
              MICROSERVICE_NAME: subscriptmgtms
          tenantmgt:
            repo: git@github.ibm.com:automation-paas-cd-pipeline/tenantmgt.git
            branch: fyre-v3.2
            local_properties:
              PLACE_HOLDER_BROKER_PATH_ELEMENT: "{{ mcsp_target['broker_path_element'] | default('csb-demo-group') }}"
              PLACE_HOLDER_REPLICAS: "1"
              MICROSERVICE_NAME: tenantmgtms
          product-registration-backend:
            repo: git@github.ibm.com:automation-paas-cd-pipeline/product-registration-backend.git
            branch: fyre-v3
            local_properties:
              PLACE_HOLDER_PR_NS: "{{ mcsp_target['namespace_pr'] | default('product-registration') }}"
              PLACE_HOLDER_REPLICAS: "1"
              MICROSERVICE_NAME: product-reg
          common-service-broker:
            repo: git@github.ibm.com:automation-paas-cd-pipeline/common-service-broker.git
            branch: fyre-v3.2
            local_properties:
              PLACE_HOLDER_REPLICAS: "1"
              MICROSERVICE_NAME: csbms
          csb-adapter:
            repo: git@github.ibm.com:automation-paas-cd-pipeline/csb-adapter.git
            branch: fyre-v3.1
            local_properties:
              PLACE_HOLDER_CSB_ADAPTER_NS: "{{ mcsp_target['namespace_csbadapter'] | default('csb-adapter-demo') }}"
              PLACE_HOLDER_REPLICAS: "1"
              MICROSERVICE_NAME: "csb-adapter"
              PLACE_HOLDER_CR_ENABLE: "true"
              PLACE_HOLDER_CSB_SERVICE_PLAN_ID: "testpak_trial"
              PLACE_HOLDER_CSB_PAID_SERVICE_PLAN_ID: "testpak_paid"
              PLACE_HOLDER_CSB_SERVICE_ID: "testpak"
        mcsp_database:
          name: dynamodblocal
          repo: git@github.ibm.com:ibm-saas-platform/dynamodblocal.git
          branch: main
          persistent: true
          suffix: Fyre
    mcsp_tenant:
      hosts:
        mcsp-tenant:
      vars:
        csb_cluster_name: gmarcy-tenantmgt-deploy
        appengine_broker_name: app-engine-broker
        appengine_broker_namespace: app-engine
        service_brokers:
          - name: "{{ appengine_broker_name }}"
            namespace: "{{ appengine_broker_namespace }}"
            dashboard_url: 'https://openliberty.io'
            replicas: "1"
            mtls_enable: "true"
            cr_enable: "true"
            image: icr.io/automation-saas-platform/csb/common-service-broker-adapter:20230321163125-main-403ee83aa22820d688661f8d8d25f9ac6e103e08
