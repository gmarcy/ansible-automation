---

- name: Create the dashboard-admin-user ServiceAccount
  kubernetes.core.k8s:
    api_key: "{{ api_key | default(omit) }}"
    kubeconfig: "{{ kubeconfig_path }}"
    api_version: v1
    kind: ServiceAccount
    name: dashboard-admin-user
    namespace: "{{ target_namespace }}"
  register: _result

- name: Create the dashboard-admin-user ClusterRoleBinding
  kubernetes.core.k8s:
    api_key: "{{ api_key | default(omit) }}"
    kubeconfig: "{{ kubeconfig_path }}"
    api_version: rbac.authorization.k8s.io/v1
    kind: ClusterRoleBinding
    name: dashboard-admin-user
    definition:
      roleRef:
        apiGroup: rbac.authorization.k8s.io
        kind: ClusterRole
        name: cluster-admin
      subjects:
        - kind: ServiceAccount
          name: dashboard-admin-user
          namespace: "{{ target_namespace }}"
  register: _result

- name: Print message with cli params to create tokens
  debug:
    msg:
    - "Run the following command to create access tokens:"
    - "  'kubectl -n {{ target_namespace }} create token dashboard-admin-user'"
