---

- name: Check for empty targetNamespaces
  set_fact:
    target_namespaces_spec:
      upgradeStrategy: Default
  when: target_namespaces | length == 0

- name: Handle non-empty targetNamespaces
  set_fact:
    target_namespaces_spec:
      targetNamespaces: "{{ target_namespaces | unique }}"
      upgradeStrategy: Default
  when: target_namespaces | length > 0

- name: Ensure target_operator_group exists
  kubernetes.core.k8s:
    api_key: "{{ api_key | default(omit) }}"
    api_version: operators.coreos.com/v1
    kind: OperatorGroup
    kubeconfig: "{{ kubeconfig_path }}"
    name: "{{ target_operator_group }}"
    namespace: "{{ target_namespace }}"
    definition:
      spec: "{{ target_namespaces_spec }}"
    state: present
  register: _result
