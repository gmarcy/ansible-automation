---

- name: Remove the primary CSV for IBM Common Service Operator
  kubernetes.core.k8s:
    api_key: "{{ api_key | default(omit) }}"
    api_version: operators.coreos.com/v1alpha1
    kind: ClusterServiceVersion
    kubeconfig: "{{ kubeconfig_path }}"
    name: "{{ common_service_operator_name }}.{{ common_service_operator_version }}"
    namespace: "{{ common_service_operator_namespace }}"
    state: absent
  register: _result

- name: Remove Subscription for IBM Common Service Operator
  kubernetes.core.k8s:
    api_key: "{{ api_key | default(omit) }}"
    api_version: operators.coreos.com/v1alpha1
    kind: Subscription
    kubeconfig: "{{ kubeconfig_path }}"
    name: "{{ common_service_operator_name }}-{{ common_service_operator_channel }}-{{ common_service_catalog_source_name }}-{{ common_service_catalog_source_namespace }}"
    namespace: "{{ common_service_operator_namespace }}"
    state: absent
    wait: true
  register: _result
